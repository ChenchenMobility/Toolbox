{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "fa680260-cb3e-41ab-86b9-cca3e097ce87",
   "metadata": {},
   "source": [
    "# 1_Circular_Region_Road_Length_Aggregation_OSM\n",
    "The code provides a 1km buffer for port regions on connected Highway and Railway"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "473404ce-41ab-4fc0-afb2-9869a8977505",
   "metadata": {},
   "outputs": [],
   "source": [
    "from OSMPythonTools.overpass import Overpass\n",
    "from geopy.distance import geodesic\n",
    "import pandas as pd\n",
    "from tqdm import tqdm\n",
    "import warnings\n",
    "warnings.filterwarnings(\"ignore\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "97c4a0bf-f3ec-400e-b74f-90c91b534bbc",
   "metadata": {},
   "outputs": [],
   "source": [
    "def calculate_length(coords):\n",
    "    total_length = 0\n",
    "    for i in range(1, len(coords)):\n",
    "        total_length += geodesic(coords[i-1], coords[i]).km\n",
    "    return total_length\n",
    "\n",
    "def get_railway_length(lat, lon, radius=3000): # radius in km if mile* 1.60934\n",
    "    # Overpass API Quary\n",
    "    query = f\"\"\"\n",
    "    (\n",
    "      way[\"railway\"=\"rail\"](around:{radius},{lat},{lon});\n",
    "    );\n",
    "    out geom;\n",
    "    out body;\n",
    "    \"\"\"\n",
    "    \n",
    "    result = overpass.query(query)\n",
    "    result_json = result.toJSON()\n",
    "\n",
    "    total_railway_length = 0\n",
    "\n",
    "    for element in result_json['elements']:\n",
    "        if 'geometry' in element:\n",
    "            coords = [(point['lat'], point['lon']) for point in element['geometry']]\n",
    "            total_railway_length += calculate_length(coords)\n",
    "\n",
    "    return total_railway_length\n",
    "\n",
    "def get_highway_length(lat, lon, radius=3000):\n",
    "    query = f\"\"\"\n",
    "    (\n",
    "      way[\"highway\"](around:{radius},{lat},{lon});\n",
    "    );\n",
    "    out geom;\n",
    "    out body;\n",
    "    \"\"\"\n",
    "    \n",
    "    result = overpass.query(query)\n",
    "    result_json = result.toJSON()\n",
    "\n",
    "    total_highway_length = 0\n",
    "\n",
    "    for element in result_json['elements']:\n",
    "        if 'geometry' in element:\n",
    "            coords = [(point['lat'], point['lon']) for point in element['geometry']]\n",
    "            total_highway_length += calculate_length(coords)\n",
    "\n",
    "    return total_highway_length"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "608bfe44-f70c-4d0e-be26-0e3dd4b9d1b7",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id</th>\n",
       "      <th>Longitude</th>\n",
       "      <th>Latitude</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>-164.526890</td>\n",
       "      <td>67.726766</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2</td>\n",
       "      <td>-151.314400</td>\n",
       "      <td>60.747930</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>3</td>\n",
       "      <td>-149.895000</td>\n",
       "      <td>61.237780</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>4</td>\n",
       "      <td>-146.346400</td>\n",
       "      <td>61.124730</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>5</td>\n",
       "      <td>-166.549916</td>\n",
       "      <td>53.894185</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>145</th>\n",
       "      <td>146</td>\n",
       "      <td>-155.827966</td>\n",
       "      <td>20.035154</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>146</th>\n",
       "      <td>147</td>\n",
       "      <td>-156.472800</td>\n",
       "      <td>20.898610</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>147</th>\n",
       "      <td>148</td>\n",
       "      <td>-157.871700</td>\n",
       "      <td>21.311110</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>148</th>\n",
       "      <td>149</td>\n",
       "      <td>-158.113683</td>\n",
       "      <td>21.323066</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>149</th>\n",
       "      <td>150</td>\n",
       "      <td>-159.352319</td>\n",
       "      <td>21.952484</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>150 rows × 3 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "      id   Longitude   Latitude\n",
       "0      1 -164.526890  67.726766\n",
       "1      2 -151.314400  60.747930\n",
       "2      3 -149.895000  61.237780\n",
       "3      4 -146.346400  61.124730\n",
       "4      5 -166.549916  53.894185\n",
       "..   ...         ...        ...\n",
       "145  146 -155.827966  20.035154\n",
       "146  147 -156.472800  20.898610\n",
       "147  148 -157.871700  21.311110\n",
       "148  149 -158.113683  21.323066\n",
       "149  150 -159.352319  21.952484\n",
       "\n",
       "[150 rows x 3 columns]"
      ]
     },
     "execution_count": 3,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df = pd.read_csv('../../2_Data/1_Port/Ports_US.csv')\n",
    "df[['id','Longitude','Latitude']]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "e5629009-02f3-4e16-bcbe-14a6d237d55f",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████| 150/150 [00:15<00:00,  9.42it/s]\n"
     ]
    }
   ],
   "source": [
    "overpass = Overpass()\n",
    "tqdm.pandas()\n",
    "df['Railway_Length'] = df.progress_apply(lambda row: get_railway_length(row['Latitude'], row['Longitude'],radius=3000), axis=1)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "a00ab8cd-b290-42cb-9626-cdea4642f44c",
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      " 57%|███████████████████████████████████████████████████████████████▋                                               | 86/150 [01:45<00:35,  1.81it/s][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,44.516215,-88.018118);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 58%|████████████████████████████████████████████████████████████████▍                                              | 87/150 [01:49<01:31,  1.46s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,42.98824,-87.89967);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 59%|█████████████████████████████████████████████████████████████████                                              | 88/150 [01:56<02:48,  2.71s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,41.88662,-87.63799);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 59%|█████████████████████████████████████████████████████████████████▊                                             | 89/150 [02:10<05:40,  5.59s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,41.625047,-87.202507);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 60%|██████████████████████████████████████████████████████████████████▌                                            | 90/150 [02:15<05:34,  5.58s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,41.515729,-88.089837);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 61%|███████████████████████████████████████████████████████████████████▎                                           | 91/150 [02:23<06:12,  6.31s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,41.340778,-88.849502);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 61%|████████████████████████████████████████████████████████████████████                                           | 92/150 [02:26<05:01,  5.20s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,41.312592,-89.201203);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 62%|████████████████████████████████████████████████████████████████████▊                                          | 93/150 [02:28<04:09,  4.37s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,40.670189,-89.604704);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 63%|█████████████████████████████████████████████████████████████████████▌                                         | 94/150 [02:34<04:34,  4.90s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,40.289261,-90.069515);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 63%|██████████████████████████████████████████████████████████████████████▎                                        | 95/150 [02:37<03:54,  4.26s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,39.716765,-91.348317);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 64%|███████████████████████████████████████████████████████████████████████                                        | 96/150 [02:39<03:16,  3.65s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,38.841903,-90.10405);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 65%|███████████████████████████████████████████████████████████████████████▊                                       | 97/150 [02:42<02:52,  3.26s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,38.626713,-90.183639);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 65%|████████████████████████████████████████████████████████████████████████▌                                      | 98/150 [02:49<03:52,  4.47s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,38.585555,-90.201366);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 66%|█████████████████████████████████████████████████████████████████████████▎                                     | 99/150 [02:52<03:35,  4.22s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,38.48219,-90.281577);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 67%|█████████████████████████████████████████████████████████████████████████▎                                    | 100/150 [02:55<03:10,  3.80s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,38.26396,-90.374604);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 67%|██████████████████████████████████████████████████████████████████████████                                    | 101/150 [02:58<02:43,  3.33s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,38.143332,-90.046146);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 68%|██████████████████████████████████████████████████████████████████████████▊                                   | 102/150 [02:59<02:12,  2.77s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,38.014533,-90.090119);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 69%|███████████████████████████████████████████████████████████████████████████▌                                  | 103/150 [03:00<01:48,  2.31s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,37.661656,-89.512469);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 69%|████████████████████████████████████████████████████████████████████████████▎                                 | 104/150 [03:01<01:30,  1.98s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,37.246444,-89.499988);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 70%|█████████████████████████████████████████████████████████████████████████████                                 | 105/150 [03:03<01:20,  1.79s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,37.144372,-88.727405);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 71%|█████████████████████████████████████████████████████████████████████████████▋                                | 106/150 [03:05<01:25,  1.95s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,37.129276,-88.693177);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 71%|██████████████████████████████████████████████████████████████████████████████▍                               | 107/150 [03:07<01:19,  1.84s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,36.581544,-89.205352);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 72%|███████████████████████████████████████████████████████████████████████████████▏                              | 108/150 [03:08<01:12,  1.72s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,36.526837,-89.56866);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 73%|███████████████████████████████████████████████████████████████████████████████▉                              | 109/150 [03:09<01:04,  1.57s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,36.211694,-89.680077);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 73%|████████████████████████████████████████████████████████████████████████████████▋                             | 110/150 [03:11<01:00,  1.51s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,35.18177,-90.06198);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 74%|█████████████████████████████████████████████████████████████████████████████████▍                            | 111/150 [03:13<01:04,  1.66s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,34.52186,-90.58323);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 75%|██████████████████████████████████████████████████████████████████████████████████▏                           | 112/150 [03:14<01:02,  1.64s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,33.813551,-91.02206);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 75%|██████████████████████████████████████████████████████████████████████████████████▊                           | 113/150 [03:15<00:54,  1.46s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,33.36781,-91.101605);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 76%|███████████████████████████████████████████████████████████████████████████████████▌                          | 114/150 [03:17<00:52,  1.45s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,32.3347,-90.90056);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 77%|████████████████████████████████████████████████████████████████████████████████████▎                         | 115/150 [03:22<01:29,  2.55s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,31.312083,-92.440674);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 77%|█████████████████████████████████████████████████████████████████████████████████████                         | 116/150 [03:30<02:26,  4.30s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,36.2182,-95.74002);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 78%|█████████████████████████████████████████████████████████████████████████████████████▊                        | 117/150 [03:34<02:11,  4.00s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,39.111694,-94.606416);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 79%|██████████████████████████████████████████████████████████████████████████████████████▌                       | 118/150 [03:39<02:25,  4.54s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,37.842685,-87.593778);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 79%|███████████████████████████████████████████████████████████████████████████████████████▎                      | 119/150 [03:43<02:16,  4.39s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,37.917978,-87.121112);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 80%|████████████████████████████████████████████████████████████████████████████████████████                      | 120/150 [03:45<01:46,  3.54s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,37.776367,-87.111688);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 81%|████████████████████████████████████████████████████████████████████████████████████████▋                     | 121/150 [03:47<01:32,  3.19s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,38.26147,-85.760993);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 81%|█████████████████████████████████████████████████████████████████████████████████████████▍                    | 122/150 [03:53<01:46,  3.81s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,39.09474,-84.510365);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 82%|██████████████████████████████████████████████████████████████████████████████████████████▏                   | 123/150 [04:17<04:30, 10.02s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,36.16513,-86.77467);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 83%|██████████████████████████████████████████████████████████████████████████████████████████▉                   | 124/150 [04:25<04:06,  9.48s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,35.02448,-85.32682);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 83%|███████████████████████████████████████████████████████████████████████████████████████████▋                  | 125/150 [04:29<03:11,  7.67s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,34.373904,-86.287506);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 84%|████████████████████████████████████████████████████████████████████████████████████████████▍                 | 126/150 [04:30<02:19,  5.79s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,27.78534,-82.52235);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 85%|█████████████████████████████████████████████████████████████████████████████████████████████▏                | 127/150 [04:31<01:37,  4.24s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,27.633681,-82.564143);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 85%|█████████████████████████████████████████████████████████████████████████████████████████████▊                | 128/150 [04:32<01:13,  3.32s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,28.41409,-80.60815);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 86%|██████████████████████████████████████████████████████████████████████████████████████████████▌               | 129/150 [04:39<01:31,  4.37s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,26.76904,-80.05267);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 87%|███████████████████████████████████████████████████████████████████████████████████████████████▎              | 130/150 [04:44<01:31,  4.58s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,26.093392,-80.117801);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 87%|████████████████████████████████████████████████████████████████████████████████████████████████              | 131/150 [04:47<01:21,  4.27s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,25.782862,-80.181642);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 88%|████████████████████████████████████████████████████████████████████████████████████████████████▊             | 132/150 [04:54<01:30,  5.03s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,40.44234,-80.01612);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 89%|█████████████████████████████████████████████████████████████████████████████████████████████████▌            | 133/150 [05:01<01:33,  5.52s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,43.227083,-86.34316);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 89%|██████████████████████████████████████████████████████████████████████████████████████████████████▎           | 134/150 [05:03<01:09,  4.37s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,44.95157,-93.0619);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 90%|███████████████████████████████████████████████████████████████████████████████████████████████████           | 135/150 [05:09<01:17,  5.14s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,46.778362,-92.096408);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 91%|███████████████████████████████████████████████████████████████████████████████████████████████████▋          | 136/150 [05:14<01:10,  5.02s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,47.014551,-91.670685);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 91%|████████████████████████████████████████████████████████████████████████████████████████████████████▍         | 137/150 [05:20<01:08,  5.24s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,47.294208,-91.256388);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████▏        | 138/150 [05:24<01:00,  5.00s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,26.201976,-97.597105);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 93%|█████████████████████████████████████████████████████████████████████████████████████████████████████▉        | 139/150 [05:26<00:42,  3.86s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,25.952201,-97.398138);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 93%|██████████████████████████████████████████████████████████████████████████████████████████████████████▋       | 140/150 [05:28<00:34,  3.43s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,18.430221,-66.111141);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 94%|███████████████████████████████████████████████████████████████████████████████████████████████████████▍      | 141/150 [05:31<00:29,  3.26s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,18.432783,-66.096678);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 95%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏     | 142/150 [05:40<00:40,  5.08s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,18.051743,-65.836226);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 95%|████████████████████████████████████████████████████████████████████████████████████████████████████████▊     | 143/150 [05:42<00:27,  4.00s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,17.938939,-66.156002);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 96%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▌    | 144/150 [05:43<00:19,  3.22s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,17.75271,-64.73242);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 97%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▎   | 145/150 [05:48<00:18,  3.65s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,19.730616,-155.054778);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 97%|███████████████████████████████████████████████████████████████████████████████████████████████████████████   | 146/150 [05:50<00:13,  3.32s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,20.035154,-155.827966);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 98%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▊  | 147/150 [05:52<00:08,  2.71s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,20.89861,-156.4728);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▌ | 148/150 [05:55<00:05,  2.82s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,21.31111,-157.8717);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      " 99%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▎| 149/150 [06:08<00:05,  5.86s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,21.323066,-158.113683);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      "100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████| 150/150 [06:10<00:00,  4.77s/it][overpass] downloading data: [timeout:25][out:json];\n",
      "    (\n",
      "      way[\"highway\"](around:3000,21.952484,-159.352319);\n",
      "    );\n",
      "    out geom;\n",
      "    out body;\n",
      "    \n",
      "100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████| 150/150 [06:12<00:00,  2.48s/it]\n"
     ]
    }
   ],
   "source": [
    "overpass = Overpass()\n",
    "tqdm.pandas()\n",
    "df['Highway_Length'] = df.progress_apply(lambda row: get_highway_length(row['Latitude'], row['Longitude'],radius=3000), axis=1)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "id": "fd51744d-f378-4019-9aa3-a277a5a6b6bd",
   "metadata": {},
   "outputs": [],
   "source": [
    "df[['id','name','Railway_Length','Highway_Length']].to_csv('../../2_Data/1_Port/Port_Connected_Rail_High_way.csv',index = False)"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.12.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
